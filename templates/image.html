<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Detection - DeepFake Detection</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='simple.css') }}">
</head>

<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="container">
            <a href="{{ url_for('homepage') }}" class="navbar-brand">
                <i class="fas fa-shield-alt"></i> DeepFake Detect
            </a>
            <div class="navbar-nav">
                {% if current_user.is_authenticated %}
                <a href="{{ url_for('detect') }}" class="nav-link">Video</a>
                <a href="{{ url_for('image_detect') }}" class="nav-link active">Image</a>
                {% if current_user.is_admin %}
                <a href="{{ url_for('admin') }}" class="nav-link">Admin</a>
                {% endif %}
                <a href="{{ url_for('logout') }}" class="nav-link">Logout</a>
                {% else %}
                <a href="{{ url_for('login') }}" class="nav-link">Login</a>
                <a href="{{ url_for('signup') }}" class="btn btn-primary btn-sm">Sign Up</a>
                {% endif %}
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main style="padding: var(--spacing-8) 0;">
        <div class="container container-md">
            <div class="text-center mb-8">
                <h1>Image Detection</h1>
                <p>Upload an image to analyze for deepfake manipulation</p>
            </div>

            {% if error %}
            <div class="alert alert-danger mb-6">
                <i class="fas fa-exclamation-circle"></i> {{ error }}
            </div>
            {% endif %}

            {% if data %}
            <!-- Results Section -->
            <div class="card mb-6">
                <div class="result-card">
                    <h2 class="mb-4">Analysis Result</h2>
                    <div class="result-badge {{ 'real' if data.output == 'REAL' else 'fake' }}">
                        {{ data.output }}
                    </div>
                    <p class="text-muted">Confidence: {{ data.confidence }}%</p>
                    <div class="confidence-bar">
                        <div class="confidence-fill" style="width: {{ data.confidence }}%;"></div>
                    </div>
                    <p class="text-muted" style="font-size: var(--font-size-sm);">
                        Processing time: {{ data.processing_time }}s
                    </p>
                </div>
            </div>

            <!-- Graphs Section -->
            {% if data.confidence_pie or data.comparison_bar %}
            <div class="card mb-6">
                <div class="card-header">
                    <h3 class="card-title">Analysis Graphs</h3>
                </div>
                <div class="card-body">
                    <div class="graphs-grid">
                        {% if data.confidence_pie %}
                        <div class="graph-card">
                            <img src="{{ url_for('static', filename=data.confidence_pie) }}" alt="Confidence Chart">
                        </div>
                        {% endif %}
                        {% if data.confidence_meter %}
                        <div class="graph-card">
                            <img src="{{ url_for('static', filename=data.confidence_meter) }}" alt="Confidence Meter">
                        </div>
                        {% endif %}
                        {% if data.comparison_bar %}
                        <div class="graph-card">
                            <img src="{{ url_for('static', filename=data.comparison_bar) }}" alt="Model Comparison">
                        </div>
                        {% endif %}
                        {% if data.comparison_hbar %}
                        <div class="graph-card">
                            <img src="{{ url_for('static', filename=data.comparison_hbar) }}"
                                alt="Performance Comparison">
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endif %}

            <div class="text-center">
                <a href="{{ url_for('image_detect') }}" class="btn btn-primary">
                    <i class="fas fa-redo"></i> Analyze Another Image
                </a>
            </div>

            {% else %}
            <!-- Upload Section -->
            <div class="card">
                <div class="card-body">
                    <form id="uploadForm" method="POST" enctype="multipart/form-data">
                        <div class="upload-area" id="uploadArea">
                            <div class="upload-icon">
                                <i class="fas fa-image"></i>
                            </div>
                            <div class="upload-text">Drag & Drop Image Here</div>
                            <div class="upload-hint">or click to browse (JPG, PNG - Max 50MB)</div>
                        </div>

                        <div class="file-input-wrapper">
                            <input type="file" id="imageFile" name="image" accept=".jpg,.jpeg,.png" required>
                            <label for="imageFile" class="file-label">
                                <i class="fas fa-image"></i> Choose Image File
                            </label>
                        </div>

                        <!-- Image Preview -->
                        <div class="video-preview hidden" id="imagePreview" style="text-align: center;">
                            <img id="previewImage"
                                style="max-width: 100%; max-height: 400px; border-radius: var(--radius);">
                            <div class="preview-actions">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-search"></i> Analyze Image
                                </button>
                                <button type="button" class="btn btn-secondary" onclick="resetUpload()">
                                    <i class="fas fa-times"></i> Cancel
                                </button>
                            </div>
                        </div>

                        <!-- Loading State -->
                        <div class="loading hidden" id="loadingState">
                            <div class="spinner"></div>
                            <p>Analyzing image... This may take a few seconds.</p>
                        </div>
                    </form>
                </div>
            </div>
            {% endif %}
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-bottom">
                <p>© 2025 DeepFake Detection. <a href="{{ url_for('privacy') }}">Privacy</a> · <a
                        href="{{ url_for('terms') }}">Terms</a></p>
            </div>
        </div>
    </footer>

    <script>
        const uploadArea = document.getElementById('uploadArea');
        const imageInput = document.getElementById('imageFile');
        const imagePreview = document.getElementById('imagePreview');
        const previewImage = document.getElementById('previewImage');
        const loadingState = document.getElementById('loadingState');
        const uploadForm = document.getElementById('uploadForm');

        // Drag and drop
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            if (file && file.type.startsWith('image/')) {
                handleFile(file);
            }
        });

        uploadArea.addEventListener('click', () => {
            imageInput.click();
        });

        imageInput.addEventListener('change', (e) => {
            if (e.target.files[0]) {
                handleFile(e.target.files[0]);
            }
        });

        function handleFile(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                previewImage.src = e.target.result;
                uploadArea.classList.add('hidden');
                document.querySelector('.file-input-wrapper').classList.add('hidden');
                imagePreview.classList.remove('hidden');
            };
            reader.readAsDataURL(file);

            // Update the file input
            const dataTransfer = new DataTransfer();
            dataTransfer.items.add(file);
            imageInput.files = dataTransfer.files;
        }

        function resetUpload() {
            previewImage.src = '';
            imageInput.value = '';
            uploadArea.classList.remove('hidden');
            document.querySelector('.file-input-wrapper').classList.remove('hidden');
            imagePreview.classList.add('hidden');
        }

        uploadForm.addEventListener('submit', () => {
            imagePreview.classList.add('hidden');
            loadingState.classList.remove('hidden');
        });
    </script>
</body>

</html>